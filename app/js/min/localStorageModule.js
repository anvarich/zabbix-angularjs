/*! angular 2013-05-20 */
"use strict";var angularLocalStorage=angular.module("LocalStorageModule",[]);angularLocalStorage.constant("prefix","ls"),angularLocalStorage.constant("cookie",{expiry:30,path:"/"}),angularLocalStorage.service("localStorageService",["$rootScope","prefix","cookie",function($rootScope,prefix,cookie){"."!==prefix.substr(-1)&&(prefix=prefix?prefix+".":"");var browserSupportsLocalStorage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}},addToLocalStorage=function(key,value){if(!browserSupportsLocalStorage())return $rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;if(!value&&0!==value&&""!==value)return!1;try{localStorage.setItem(prefix+key,value)}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}return!0},getFromLocalStorage=function(key){if(!browserSupportsLocalStorage())return $rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var item=localStorage.getItem(prefix+key);return item?item:null},removeFromLocalStorage=function(key){if(!browserSupportsLocalStorage())return $rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;try{localStorage.removeItem(prefix+key)}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}return!0},clearAllFromLocalStorage=function(){if(!browserSupportsLocalStorage())return $rootScope.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var prefixLength=prefix.length;for(var key in localStorage)if(key.substr(0,prefixLength)===prefix)try{removeFromLocalStorage(key.substr(prefixLength))}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}return!0},browserSupportsCookies=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}},addToCookies=function(key,value){if(value===void 0)return!1;if(!browserSupportsCookies())return $rootScope.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var expiry="",expiryDate=new Date;null===value&&(cookie.expiry=-1,value=""),0!==cookie.expiry&&(expiryDate.setTime(expiryDate.getTime()+1e3*60*60*24*cookie.expiry),expiry="; expires="+expiryDate.toGMTString()),document.cookie=prefix+key+"="+encodeURIComponent(value)+expiry+"; path="+cookie.path}catch(e){return $rootScope.$broadcast("LocalStorageModule.notification.error",e.Description),!1}return!0},getFromCookies=function(key){if(!browserSupportsCookies())return $rootScope.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var cookies=document.cookie.split(";"),i=0;cookies.length>i;i++){for(var thisCookie=cookies[i];" "==thisCookie.charAt(0);)thisCookie=thisCookie.substring(1,thisCookie.length);if(0==thisCookie.indexOf(prefix+key+"="))return decodeURIComponent(thisCookie.substring(prefix.length+key.length+1,thisCookie.length))}return null},removeFromCookies=function(key){addToCookies(key,null)},clearAllFromCookies=function(){for(var thisCookie=null,prefixLength=prefix.length,cookies=document.cookie.split(";"),i=0;cookies.length>i;i++){for(thisCookie=cookies[i];" "==thisCookie.charAt(0);)thisCookie=thisCookie.substring(1,thisCookie.length);key=thisCookie.substring(prefixLength,thisCookie.indexOf("=")),removeFromCookies(key)}};return{isSupported:browserSupportsLocalStorage,add:addToLocalStorage,get:getFromLocalStorage,remove:removeFromLocalStorage,clearAll:clearAllFromLocalStorage,cookie:{add:addToCookies,get:getFromCookies,remove:removeFromCookies,clearAll:clearAllFromCookies}}}]);